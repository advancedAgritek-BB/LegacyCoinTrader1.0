{% extends 'base.html' %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Asset Scores</span>
        <button class="btn btn-primary btn-sm" onclick="generateScores()">
          <i class="fas fa-sync-alt"></i> Generate Scores
        </button>
      </div>
      <div class="card-body">
        {% if scans and scans|length > 0 %}
        <div class="alert alert-info">
          <i class="fas fa-info-circle"></i>
          Showing {{ scans|length }} asset scores. Higher scores indicate better performance.
        </div>
        <div class="table-responsive">
          <table class="table table-bordered table-hover mb-0">
            <thead class="table-dark">
              <tr>
                <th>Rank</th>
                <th>Symbol</th>
                <th>Score</th>
                <th>Performance</th>
              </tr>
            </thead>
            <tbody>
            {% for sym, score in scans.items() %}
              <tr>
                <td>{{ loop.index }}</td>
                <td><strong>{{ sym }}</strong></td>
                <td>
                  <span class="badge {% if score > 0 %}bg-success{% elif score < 0 %}bg-danger{% else %}bg-secondary{% endif %}">
                    {{ '%.4f'|format(score) }}
                  </span>
                </td>
                <td>
                  {% if score > 1.0 %}
                    <span class="text-success"><i class="fas fa-rocket"></i> Excellent</span>
                  {% elif score > 0.5 %}
                    <span class="text-success"><i class="fas fa-arrow-up"></i> Good</span>
                  {% elif score > 0 %}
                    <span class="text-warning"><i class="fas fa-minus"></i> Neutral</span>
                  {% else %}
                    <span class="text-danger"><i class="fas fa-arrow-down"></i> Poor</span>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="text-center py-4">
          <i class="fas fa-chart-line fa-3x text-muted mb-3"></i>
          <h5 class="text-muted">No Asset Scores Available</h5>
          <p class="text-muted">
            Asset scores haven't been generated yet. Click the "Generate Scores" button above to create sample scores,
            or wait for the bot to automatically generate scores during portfolio rotation.
          </p>
          <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle"></i>
            <strong>Note:</strong> Asset scores are generated by the portfolio rotation system when the bot is running.
            Make sure portfolio rotation is enabled in your configuration.
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
function generateScores() {
  const button = event.target;
  const originalText = button.innerHTML;
  
  // Show loading state
  button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
  button.disabled = true;
  
  // Make request to generate scores
  fetch('/api/generate_scores', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      // Reload the page to show new scores
      location.reload();
    } else {
      alert('Error generating scores: ' + (data.error || 'Unknown error'));
      button.innerHTML = originalText;
      button.disabled = false;
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('Error generating scores. Check console for details.');
    button.innerHTML = originalText;
    button.disabled = false;
  });
}
</script>
{% endblock %}
